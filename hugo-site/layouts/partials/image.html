{{/*
  Image partial - WebP only (no fallback)
  
  Serves WebP images directly. Since originals are deleted after conversion,
  this simply renders the WebP image.
  
  Usage: 
    {{ partial "image.html" (dict "src" "/images/photo.jpg" "alt" "A photo") }}
    {{ partial "image.html" (dict "src" "photo.jpg" "alt" "Featured" "class" "featured-image" "loading" "eager") }}
  
  Parameters:
    - src: Image path (e.g., "/images/photo.jpg" or "photo.jpg")
    - alt: Alt text (required for accessibility)
    - class: CSS class names (optional)
    - loading: Loading attribute - "lazy" or "eager" (default: "lazy")
*/}}

{{ $src := .src }}
{{ $alt := .alt | default "" }}
{{ $class := .class | default "" }}
{{ $loading := .loading | default "lazy" }}

{{ if not $src }}
  {{ errorf "partial 'image.html': 'src' parameter is required" }}
{{ end }}
{{ if not $alt }}
  {{ warnf "partial 'image.html': 'alt' parameter is missing - required for accessibility" }}
{{ end }}

{{ $srcPath := $src }}
{{ if hasPrefix $src "/" }}
  {{ $srcPath = strings.TrimPrefix "/" $src }}
{{ end }}

{{ $fileStem := path.BaseName $srcPath }}
{{ $fileDir := path.Dir $srcPath }}
{{ if eq $fileDir "." }}
  {{ $fileDir = "" }}
{{ else }}
  {{ $fileDir = printf "%s/" $fileDir }}
{{ end }}

{{ $webpPath := printf "%s%s.webp" $fileDir $fileStem }}

<img src="{{ $webpPath }}" alt="{{ $alt }}" class="{{ $class }}" loading="{{ $loading }}">
