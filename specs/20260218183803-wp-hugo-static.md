# Work Plan: wp-hugo-static

## TL;DR

> **Build a reusable, open-source harness that turns WordPress into a static site using Hugo.**
> 
> **Deliverables**:
> - Complete Docker setup (WordPress + MariaDB + Caddy + WUD)
> - Hugo base site with Stack theme + Giscus comments
> - WPâ†’Hugo conversion scripts (posts + pages)
> - GitHub Actions workflow for CI/CD
> - Generic setup script + comprehensive README
> 
> **Estimated Effort**: Medium (5-6 weeks)
> **Parallel Execution**: NO - Synchronous step-by-step
> **Execution Mode**: Sequential with per-task commits for rollback safety
> **Critical Path**: Phase 1 â†’ Phase 2 â†’ Phase 3 â†’ Phase 4 â†’ Phase 5

---

## Context

### Original Request
Create a reusable harness for running WordPress as a headless CMS that builds to a static site via Hugo, deployed to Cloudflare Pages.

### Stack Decisions Confirmed
| Component | Choice | Notes |
|-----------|--------|-------|
| VM Platform | Proxmox | Home hardware |
| Container Updates | WUD (What's Up Docker) | Semi-auto, replaces unmaintained Watchtower |
| Caddy | Custom build with Cloudflare ACME | DNS challenge for SSL certs |
| Backup Schedule | Cron 2:30am daily | 30-day retention |
| WP API | REST API | `/wp-json/wp/v2/posts` and `/pages` |
| Images | Download at build | Fully static site |
| SSG | Hugo | Static site generator |
| Theme | Stack (via Hugo Modules) | Clean, modern, Giscus support |
| Dependency Management | Hugo Modules | Replaces git submodules, requires Go |
| Comments | Giscus | GitHub Discussions |
| CI/CD | GitHub Actions | Build â†’ Cloudflare Pages |
| Repo Name | `wp-hugo-static` | Generic, open-source |
| Content | Hybrid | WP posts/pages + Hugo custom pages |

### Metis Review
**Identified considerations addressed**:
- WUD replaces unmaintained Watchtower
- Hugo Modules used instead of git submodules (requires Go)
- Manual setup steps (Giscus, Cloudflare) documented in README
- API keys/secrets documented
- Hybrid content strategy (WP + Hugo pages) supported
- Generic harness with setup.sh for configuration

---

## Work Objectives

### Core Objective
Create an open-source, reusable infrastructure harness that allows anyone to self-host WordPress (Tailscale-accessible), automatically build static sites via Hugo, and deploy to Cloudflare Pages.

### Concrete Deliverables
- `docker-compose.yml` with WP, MariaDB, Caddy, WUD
- `backup.sh` with cron scheduling
- Hugo site with Stack theme and Giscus integration
- `scripts/fetch-wp-content.py` for WPâ†’Hugo conversion
- `.github/workflows/deploy.yml` for CI/CD
- `setup.sh` for generic configuration
- `README.md` with full documentation
- Example implementation at paraboss.com

### Definition of Done
- [ ] WordPress accessible via Tailscale at configured domain
- [ ] WUD auto-updates containers on schedule
- [ ] Daily backups run and are restorable
- [ ] WP publish triggers GitHub Actions via webhook
- [ ] Hugo builds successfully from WP content
- [ ] Site deploys to Cloudflare Pages
- [ ] Giscus comments render on posts
- [ ] Setup script runs without errors
- [ ] README explains full setup process
- [ ] Repo is public and documented

### Must Have
- Working WordPress instance with auto-container-updates
- Automated backups before updates
- Hugo site building from WP REST API
- GitHub Actions CI/CD pipeline
- Cloudflare Pages deployment
- Giscus comments integration
- Generic, reusable codebase
- Comprehensive README

### Must NOT Have (Guardrails)
- No paraboss-specific values committed to repo
- No secrets in code (use .env + setup.sh)
- No custom theme development (use Stack base)
- No scheduled WP posts (manual/webhook only)
- No production-grade monitoring (homelab scope)

---

## Verification Strategy

### Test Infrastructure
- **Local**: Docker Compose runs on Proxmox VM
- **CI/CD**: GitHub Actions builds on Ubuntu latest
- **Hosting**: Cloudflare Pages (free tier)

### QA Policy
Each task includes verification steps:
- Docker services start without errors
- WUD detects and updates containers
- Backups are created and restorable
- WP webhook triggers GitHub Actions
- Hugo builds successfully
- Cloudflare Pages receives deployment
- Giscus loads on posts

### Manual Verification Steps
1. Access WP via Tailscale domain
2. Publish test post â†’ verify Actions trigger
3. Verify site updates on Cloudflare Pages
4. Test comment on post via Giscus
5. Verify backup files created
6. Test restore from backup

---

## Execution Strategy

### Sequential Execution (Step-by-Step)

**Execution Mode**: Each task is completed synchronously with individual commits. This allows for:
- Monitoring and adjusting the plan as needed
- Easy rollback to any previous step
- Clear audit trail of changes
- Validation before proceeding to next task

```
Phase 1 (Week 1-2): WordPress Infrastructure
â†“ Task 1.1: Docker Compose setup
â†“ Task 1.2: WUD configuration
â†“ Task 1.3: Backup system with cron
â†“ Task 1.4: Tailscale integration
â†“ Task 1.5: WordPress initial config + security

Phase 2 (Week 2-3): Hugo Base Setup
â†“ Task 2.1: Hugo initialization with Stack theme
â†“ Task 2.2: Hugo configuration (hugo.toml)
â†“ Task 2.3: Giscus integration
â†“ Task 2.4: Basic content structure + sample posts

Phase 3 (Week 3-4): Content Pipeline
â†“ Task 3.1: WPâ†’Hugo conversion scripts (posts)
â†“ Task 3.2: WPâ†’Hugo conversion scripts (pages)
â†“ Task 3.3: Image download and optimization
â†“ Task 3.4: GitHub Actions workflow
â†“ Task 3.5: WP webhook integration
â†“ Task 3.6: Hybrid content support (custom pages)

Phase 4 (Week 4-5): Polish & Documentation
â†“ Task 4.1: Generic setup.sh script
â†“ Task 4.2: Comprehensive README
â†“ Task 4.3: Theme customization (site-specific)
â†“ Task 4.4: Security hardening and review

Phase 5 (Week 5-6): Launch & Open Source
â†“ Task 5.1: Final end-to-end testing
â†“ Task 5.2: Content migration
â†“ Task 5.3: Domain and DNS setup
â†“ Task 5.4: Open source preparation
â†“ Task 5.5: Repository publication
```

### Rollback Strategy
Each task commit creates a checkpoint. If issues arise:
1. Stop current task
2. `git revert` or `git reset` to last known good commit
3. Fix issues
4. Re-attempt task
5. Proceed to next task only after validation

---

## TODOs

- [ ] 1.1 Create Docker Compose configuration

  **What to do**:
  - Create `docker-compose.yml` with services: wordpress, mariadb, caddy, wud
  - Create `Dockerfile.caddy` to build Caddy with Cloudflare ACME plugin
  - Create `Caddyfile` with Cloudflare DNS challenge and security headers
  - Configure WUD labels for wordpress, mariadb, caddy containers
  - Set up persistent volumes for db-data, wp-content, caddy-data
  - Use environment variables from .env for all secrets
  - Pin specific image versions (wordpress:6.4-apache, mariadb:10.11)

  **Must NOT do**:
  - Do not commit actual .env file
  - Do not use 'latest' tag for production containers

  **Recommended Agent Profile**:
  - **Category**: `quick`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits)
  - **Next Task**: 1.2
  - **Previous Task**: None

  **References**:
  - Docker Compose file reference: https://docs.docker.com/compose/compose-file/
  - WUD documentation: https://getwud.github.io/wud/
  - WordPress Docker image: https://hub.docker.com/_/wordpress

  **Acceptance Criteria**:
  - [ ] `docker-compose.yml` exists with all 4 services
  - [ ] `Dockerfile.caddy` exists with Cloudflare plugin
  - [ ] `Caddyfile` exists with ACME DNS challenge config
  - [ ] `docker compose config` validates without errors
  - [ ] WUD labels are correctly configured for auto-update
  - [ ] .env.example created with placeholder values

  **QA Scenarios**:
  ```
  Scenario: Docker Compose validation
    Tool: Bash
    Preconditions: docker-compose.yml exists
    Steps:
      1. Run: docker compose config
      2. Verify: No errors, all services defined
    Expected Result: Command exits 0, config is valid
    Evidence: .sisyphus/evidence/task-1-1-compose-validation.txt
  ```

  **Commit**: YES
  - Message: `feat(infra): Add Docker Compose with WordPress, MariaDB, Caddy, and WUD`
  - Files: `docker-compose.yml`, `Dockerfile.caddy`, `Caddyfile`, `.env.example`, `.gitignore`

- [ ] 1.2 Configure WUD for semi-auto container updates

  **What to do**:
  - Add WUD service to docker-compose with proper environment variables
  - Configure WUD_WATCHER_LOCAL_CRON for 3:00am daily checks
  - Enable WUD_TRIGGER_DOCKERCOMPOSE_AUTO for auto-updates
  - Set WUD_TRIGGER_DOCKERCOMPOSE_PRUNE to clean old images
  - Configure web UI on port 3000

  **Must NOT do**:
  - Do not enable auto-update without backup strategy
  - Do not expose WUD UI to public internet

  **Recommended Agent Profile**:
  - **Category**: `quick`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits)
  - **Next Task**: None
  - **Previous Task**: 1.1

  **References**:
  - WUD triggers documentation: https://getwud.github.io/wud/#/configuration/triggers/
  - WUD watchers documentation: https://getwud.github.io/wud/#/configuration/watchers/

  **Acceptance Criteria**:
  - [ ] WUD container starts successfully
  - [ ] WUD detects all labeled containers
  - [ ] WUD web UI accessible at port 3000
  - [ ] Cron schedule configured for 3:00am

  **QA Scenarios**:
  ```
  Scenario: WUD detects containers
    Tool: Bash
    Preconditions: Docker Compose is running
    Steps:
      1. Run: docker logs wud | grep "Container"
      2. Verify: WUD found wordpress, mariadb, caddy
    Expected Result: Logs show 3 containers detected
    Evidence: .sisyphus/evidence/task-1-2-wud-detection.txt
  ```

  **Commit**: YES (grouped with 1.1)

- [ ] 1.3 Create backup system with cron scheduling

  **What to do**:
  - Create `backup.sh` script that backs up DB and wp-content
  - Script dumps MariaDB to compressed SQL file
  - Script archives wp-content directory
  - Configure cron for 2:30am daily execution
  - Implement 30-day retention (delete files older than 30 days)
  - Test restore procedure

  **Must NOT do**:
  - Do not backup to ephemeral storage
  - Do not skip backup before WUD updates

  **Recommended Agent Profile**:
  - **Category**: `quick`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits)
  - **Next Task**: None
  - **Previous Task**: 1.1

  **References**:
  - mysqldump documentation: https://mariadb.com/kb/en/mysqldump/
  - Cron syntax: https://crontab.guru/

  **Acceptance Criteria**:
  - [ ] backup.sh exists and is executable
  - [ ] Backup creates .sql.gz and .tar.gz files
  - [ ] Cron job configured for 2:30am daily
  - [ ] Old backups (30+ days) are deleted
  - [ ] Restore procedure documented and tested

  **QA Scenarios**:
  ```
  Scenario: Backup creation
    Tool: Bash
    Preconditions: WordPress has content
    Steps:
      1. Run: ./backup.sh
      2. Verify: Files created in backup directory
      3. Verify: Files are valid archives
    Expected Result: Backup files exist and are readable
    Evidence: .sisyphus/evidence/task-1-3-backup-files.txt

  Scenario: Restore from backup
    Tool: Bash
    Preconditions: Backup files exist
    Steps:
      1. Stop containers
      2. Remove volumes
      3. Run restore procedure
      4. Start containers
      5. Verify content is restored
    Expected Result: WordPress shows original content
    Evidence: .sisyphus/evidence/task-1-3-restore-test.txt
  ```

  **Commit**: YES
  - Message: `feat(infra): Add backup system with daily cron`
  - Files: `backup.sh`, `crontab.example`, `restore.sh`

- [ ] 1.4 Configure Tailscale for secure access

  **What to do**:
  - Install Tailscale on Proxmox VM
  - Configure Magic DNS for ${DOMAIN} (e.g., wordpress.your-tailnet.tsa.dev)
  - Verify HTTPS certificates work automatically
  - Document access URLs in README
  - Test access from Tailscale-connected devices

  **Must NOT do**:
  - Do not expose WP admin to public internet
  - Do not rely on IP addresses instead of DNS

  **Recommended Agent Profile**:
  - **Category**: `quick`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits)
  - **Next Task**: 1.5
  - **Previous Task**: 1.1

  **References**:
  - Tailscale on Linux: https://tailscale.com/kb/1031/install-linux
  - Magic DNS: https://tailscale.com/kb/1081/magicdns

  **Acceptance Criteria**:
  - [ ] Tailscale installed and running
  - [ ] Machine shows in Tailscale admin console
  - [ ] https://${DOMAIN} is accessible
  - [ ] HTTPS certificate valid

  **QA Scenarios**:
  ```
  Scenario: Tailscale access
    Tool: Bash (from Tailscale-connected machine)
    Preconditions: Tailscale running on both ends
    Steps:
      1. Run: curl -I https://${DOMAIN}
      2. Verify: HTTP 200 response
    Expected Result: Connection succeeds, cert is valid
    Evidence: .sisyphus/evidence/task-1-4-tailscale-access.txt
  ```

  **Commit**: NO (infrastructure configuration, not code)

- [ ] 1.5 Configure WordPress initial setup and security

  **What to do**:
  - Complete WordPress installation wizard
  - Disable auto-updates (AUTOMATIC_UPDATER_DISABLED, WP_AUTO_UPDATE_CORE)
  - Install and configure WP Webhooks plugin (or custom PHP)
  - Configure webhook to trigger on post publish
  - Set permalink structure to /posts/%postname%/
  - Disable XML-RPC and REST API user enumeration
  - Configure Caddy security headers

  **Must NOT do**:
  - Do not enable WP auto-updates (we manage containers)
  - Do not leave default admin username

  **Recommended Agent Profile**:
  - **Category**: `quick`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits)
  - **Next Task**: 3.5
  - **Previous Task**: 1.1, 1.4

  **References**:
  - WP Webhooks plugin: https://wordpress.org/plugins/wp-webhooks/
  - WP REST API: https://developer.wordpress.org/rest-api/

  **Acceptance Criteria**:
  - [ ] WordPress accessible and functional
  - [ ] Permalink structure set
  - [ ] Webhook configured for post publish
  - [ ] Security hardening applied

  **QA Scenarios**:
  ```
  Scenario: WP REST API access
    Tool: Bash
    Preconditions: WordPress running, test post exists
    Steps:
      1. Run: curl https://${DOMAIN}/wp-json/wp/v2/posts
      2. Verify: JSON response with posts
    Expected Result: API returns post data
    Evidence: .sisyphus/evidence/task-1-5-wp-api.txt
  ```

  **Commit**: Partial (Caddyfile security headers, webhook config docs)

- [ ] 2.1 Initialize Hugo site with Stack theme

  **What to do**:
  - Install Hugo extended version and Go
  - Create new Hugo site: `hugo new site hugo-site`
  - Initialize Hugo Modules: create `go.mod` with Stack theme dependency
  - Configure `hugo.toml` to use Hugo Modules (not git submodules)
  - Create site directory structure
  - Run `hugo mod get` to download Stack theme

  **Must NOT do**:
  - Do not use git submodules (use Hugo Modules instead)
  - Do not commit theme files directly (managed by Go modules)
  - Do not modify theme files directly (use overrides)

  **Recommended Agent Profile**:
  - **Category**: `quick`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits) (with Phase 1)
  - **Next Task**: 2.2, 2.3, 2.4
  - **Previous Task**: None

  **References**:
  - Hugo installation: https://gohugo.io/installation/
  - Stack theme: https://github.com/CaiJimmy/hugo-theme-stack
  - Hugo quick start: https://gohugo.io/getting-started/quick-start/

  **Acceptance Criteria**:
  - [ ] Hugo site directory created
  - [ ] Hugo Modules configured (go.mod with Stack theme)
  - [ ] hugo.toml uses module imports (not theme = "")
  - [ ] `hugo mod get` downloads theme successfully
  - [ ] `hugo server` runs without errors

  **QA Scenarios**:
  ```
  Scenario: Hugo modules download theme
    Tool: Bash
    Preconditions: Hugo and Go installed
    Steps:
      1. Run: cd hugo-site && hugo mod get
      2. Verify: Stack theme downloaded to $GOPATH/pkg/mod
      3. Run: hugo server -D
    Expected Result: Theme loads, server runs on :1313
    Evidence: .sisyphus/evidence/task-2-1-hugo-modules.txt
  ```

  **Commit**: YES
  - Message: `feat(site): Initialize Hugo with Stack theme via Hugo Modules`
  - Files: `hugo-site/` directory, `hugo-site/go.mod`, `hugo-site/hugo.toml`

- [ ] 2.2 Configure Hugo site (hugo.toml)

  **What to do**:
  - Create hugo.toml with site metadata (title, description, author)
  - Use placeholder values (configured via setup.sh later)
  - Configure language and timezone
  - Set up pagination
  - Configure RSS and sitemap
  - Set up menu structure (Home, Posts, About, Contact)

  **Must NOT do**:
  - Do not hardcode paraboss-specific values
  - Do not commit real author email

  **Recommended Agent Profile**:
  - **Category**: `quick`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits)
  - **Next Task**: 2.3
  - **Previous Task**: 2.1

  **References**:
  - Hugo configuration: https://gohugo.io/getting-started/configuration/
  - Stack theme configuration: https://stack.jimmycai.com/config/

  **Acceptance Criteria**:
  - [ ] hugo.toml exists with all required fields
  - [ ] Site builds without errors
  - [ ] Menu shows correct navigation items
  - [ ] Placeholders used for personal info

  **QA Scenarios**:
  ```
  Scenario: Hugo build succeeds
    Tool: Bash
    Preconditions: hugo.toml configured
    Steps:
      1. Run: hugo --minify
      2. Verify: public/ directory created
      3. Verify: No build errors
    Expected Result: Build exits 0
    Evidence: .sisyphus/evidence/task-2-2-hugo-build.txt
  ```

  **Commit**: YES
  - Message: `feat(site): Configure Hugo site settings`
  - Files: `hugo-site/hugo.toml`

- [ ] 2.3 Integrate Giscus comments

  **What to do**:
  - Enable GitHub Discussions on repository
  - Install Giscus app from GitHub Marketplace
  - Configure Giscus (repo, discussion category, theme)
  - Add Giscus partial to Hugo templates
  - Configure in hugo.toml (params.comments)
  - Test comments render on sample post

  **Must NOT do**:
  - Do not use Disqus or other tracking comment systems
  - Do not enable comments on pages (only posts)

  **Recommended Agent Profile**:
  - **Category**: `quick`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits)
  - **Next Task**: None
  - **Previous Task**: 2.1

  **References**:
  - Giscus website: https://giscus.app/
  - Stack theme comments: https://stack.jimmycai.com/config/comments/

  **Acceptance Criteria**:
  - [ ] GitHub Discussions enabled on repo
  - [ ] Giscus app installed and configured
  - [ ] Comments partial added to theme
  - [ ] Comments load on post pages

  **QA Scenarios**:
  ```
  Scenario: Giscus loads on post
    Tool: Browser/Playwright
    Preconditions: Sample post exists, Giscus configured
    Steps:
      1. Navigate to a post
      2. Scroll to comments section
      3. Verify: Giscus iframe loads
    Expected Result: Comments section visible
    Evidence: .sisyphus/evidence/task-2-3-giscus-load.png
  ```

  **Commit**: YES (partial - partial template and config)
  - Message: `feat(site): Add Giscus comments integration`
  - Files: `hugo-site/layouts/partials/comments.html`, config updates

- [ ] 2.4 Set up content structure and sample posts

  **What to do**:
  - Create content directory structure (content/posts/, content/pages/)
  - Create archetypes for posts and pages
  - Create sample posts with proper frontmatter
  - Create sample pages (about, contact)
  - Test pagination and list pages

  **Must NOT do**:
  - Do not use complex content structures (keep it simple)
  - Do not commit large images to git

  **Recommended Agent Profile**:
  - **Category**: `quick`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits)
  - **Next Task**: None
  - **Previous Task**: 2.1

  **References**:
  - Hugo content organization: https://gohugo.io/content-management/organization/
  - Hugo archetypes: https://gohugo.io/content-management/archetypes/

  **Acceptance Criteria**:
  - [ ] content/posts/ and content/pages/ directories exist
  - [ ] archetypes/default.md created
  - [ ] Sample posts display correctly
  - [ ] Homepage shows post list

  **QA Scenarios**:
  ```
  Scenario: Sample content displays
    Tool: Browser
    Preconditions: Hugo server running
    Steps:
      1. Navigate to localhost:1313
      2. Verify: Post list visible
      3. Click a post
      4. Verify: Post content renders
    Expected Result: Content displays correctly
    Evidence: .sisyphus/evidence/task-2-4-content-display.png
  ```

  **Commit**: YES (sample content can be removed later)
  - Message: `feat(site): Add content structure and samples`
  - Files: `hugo-site/content/`, `hugo-site/archetypes/`

- [ ] 3.1 Create WPâ†’Hugo conversion script for posts

  **What to do**:
  - Create `scripts/fetch-posts.py` (Python) or `scripts/fetch-posts.js` (Node.js)
  - Script fetches from WP REST API: `/wp-json/wp/v2/posts`
  - Convert WP HTML content to Markdown (use html2text or similar)
  - Generate Hugo frontmatter from WP post metadata (title, date, slug, categories, tags)
  - Output to `hugo-site/content/posts/`
  - Handle pagination for many posts
  - Support featured image detection

  **Must NOT do**:
  - Do not commit WP credentials to script
  - Do not overwrite manual content without backup

  **Recommended Agent Profile**:
  - **Category**: `unspecified-high`
  - **Skills**: []

  **Parallelization**:
  - **Can Run In Parallel**: NO (depends on WP setup)
  - **Next Task**: 3.3, 3.4
  - **Previous Task**: 1.5

  **References**:
  - WP REST API posts endpoint: https://developer.wordpress.org/rest-api/reference/posts/
  - html2text Python library: https://github.com/Alir3z4/html2text
  - Hugo frontmatter: https://gohugo.io/content-management/front-matter/

  **Acceptance Criteria**:
  - [ ] Script fetches posts from WP API
  - [ ] HTML content converts to valid Markdown
  - [ ] Hugo frontmatter generated correctly
  - [ ] Posts saved to content/posts/ directory
  - [ ] Script handles errors gracefully

  **QA Scenarios**:
  ```
  Scenario: Fetch and convert posts
    Tool: Bash
    Preconditions: WordPress has published posts
    Steps:
      1. Run: python scripts/fetch-posts.py
      2. Verify: Files created in content/posts/
      3. Verify: Hugo builds successfully
    Expected Result: Posts converted and buildable
    Evidence: .sisyphus/evidence/task-3-1-posts-conversion.txt
  ```

  **Commit**: YES
  - Message: `feat(pipeline): Add WP posts to Hugo conversion script`
  - Files: `scripts/fetch-posts.py`, `scripts/requirements.txt`

- [ ] 3.2 Create WPâ†’Hugo conversion script for pages

  **What to do**:
  - Create `scripts/fetch-pages.py`
  - Script fetches from WP REST API: `/wp-json/wp/v2/pages`
  - Convert WP page HTML to Markdown
  - Generate Hugo frontmatter
  - Output to `hugo-site/content/pages/`
  - Support page hierarchy (parent/child pages)
  - Support custom page templates (template frontmatter field)

  **Must NOT do**:
  - Do not overwrite existing Hugo pages
  - Do not fetch draft or private pages

  **Recommended Agent Profile**:
  - **Category**: `unspecified-high`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits)
  - **Next Task**: None
  - **Previous Task**: 1.5

  **References**:
  - WP REST API pages endpoint: https://developer.wordpress.org/rest-api/reference/pages/
  - Hugo content types: https://gohugo.io/content-management/types/

  **Acceptance Criteria**:
  - [ ] Script fetches pages from WP API
  - [ ] Pages converted to Markdown with frontmatter
  - [ ] Pages saved to content/pages/
  - [ ] Template field respected if set in WP

  **QA Scenarios**:
  ```
  Scenario: Fetch and convert pages
    Tool: Bash
    Preconditions: WordPress has published pages
    Steps:
      1. Run: python scripts/fetch-pages.py
      2. Verify: Files created in content/pages/
      3. Verify: Pages accessible on site
    Expected Result: Pages converted and accessible
    Evidence: .sisyphus/evidence/task-3-2-pages-conversion.txt
  ```

  **Commit**: YES
  - Message: `feat(pipeline): Add WP pages to Hugo conversion script`
  - Files: `scripts/fetch-pages.py`

- [ ] 3.3 Implement image download and optimization

  **What to do**:
  - Extend conversion scripts to download images
  - Parse post content for image URLs
  - Download images to `hugo-site/static/images/`
  - Preserve original filenames or use date-based naming
  - Rewrite image URLs in Markdown to local paths
  - Optimize images (optional: use Hugo image processing)
  - Handle featured images

  **Must NOT do**:
  - Do not hotlink images (download everything)
  - Do not commit large images to git if possible (use LFS or external storage)

  **Recommended Agent Profile**:
  - **Category**: `unspecified-high`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits)
  - **Next Task**: None
  - **Previous Task**: 3.1, 3.2

  **References**:
  - Hugo image processing: https://gohugo.io/content-management/image-processing/
  - Python requests for downloading: https://docs.python-requests.org/

  **Acceptance Criteria**:
  - [ ] Images downloaded to static/images/
  - [ ] Markdown content references local image paths
  - [ ] Featured images handled correctly
  - [ ] Images display on built site

  **QA Scenarios**:
  ```
  Scenario: Images downloaded and displayed
    Tool: Browser
    Preconditions: Posts with images converted
    Steps:
      1. Build Hugo site
      2. Open a post with images
      3. Verify: Images load correctly
    Expected Result: Images display, no 404 errors
    Evidence: .sisyphus/evidence/task-3-3-images-display.png
  ```

  **Commit**: YES
  - Message: `feat(pipeline): Add image download and optimization`
  - Files: `scripts/fetch-images.py` or integrated into fetch scripts

- [ ] 3.4 Create GitHub Actions workflow for CI/CD

  **What to do**:
  - Create `.github/workflows/deploy.yml`
  - Trigger: repository_dispatch, workflow_dispatch, push to main
  - Steps: checkout, setup Hugo, fetch WP content, build, deploy to Cloudflare Pages
  - Use Cloudflare Pages GitHub Action
  - Configure secrets: CLOUDFLARE_API_TOKEN, CLOUDFLARE_ACCOUNT_ID
  - Add WP_API_URL environment variable
  - Cache Hugo modules for faster builds

  **Must NOT do**:
  - Do not hardcode secrets in workflow file
  - Do not expose WP API credentials in logs

  **Recommended Agent Profile**:
  - **Category**: `unspecified-high`
  - **Skills**: []

  **Parallelization**:
  - **Can Run In Parallel**: NO (depends on scripts)
  - **Next Task**: 3.5, 5.1
  - **Previous Task**: 3.1, 3.2, 3.3

  **References**:
  - Cloudflare Pages Action: https://github.com/marketplace/actions/cloudflare-pages-github-action
  - GitHub Actions workflow syntax: https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions
  - Hugo setup action: https://github.com/peaceiris/actions-hugo

  **Acceptance Criteria**:
  - [ ] Workflow file exists and is valid
  - [ ] Workflow triggers on repository_dispatch
  - [ ] Hugo builds successfully in Actions
  - [ ] Site deploys to Cloudflare Pages
  - [ ] Secrets configured in GitHub

  **QA Scenarios**:
  ```
  Scenario: Manual workflow trigger
    Tool: GitHub UI
    Preconditions: Workflow file committed
    Steps:
      1. Go to Actions tab
      2. Trigger workflow manually
      3. Wait for completion
    Expected Result: Workflow succeeds, site updates
    Evidence: .sisyphus/evidence/task-3-4-workflow-run.txt
  ```

  **Commit**: YES
  - Message: `feat(pipeline): Add GitHub Actions CI/CD workflow`
  - Files: `.github/workflows/deploy.yml`

- [ ] 3.5 Configure WordPress webhook for publish trigger

  **What to do**:
  - Install WP Webhooks plugin (or add custom PHP to functions.php)
  - Configure webhook to fire on post publish
  - Set webhook URL to GitHub repository dispatch endpoint
  - Add GitHub Personal Access Token for authentication
  - Set event type to 'wordpress-publish'
  - Test webhook triggers Actions workflow

  **Must NOT do**:
  - Do not commit GitHub token to WP files
  - Do not trigger on draft saves (only publish)

  **Recommended Agent Profile**:
  - **Category**: `quick`
  - **Skills**: []

  **Parallelization**:
  - **Can Run In Parallel**: NO (needs WP and Actions)
  - **Next Task**: 5.1
  - **Previous Task**: 1.5, 3.4

  **References**:
  - GitHub repository dispatch: https://docs.github.com/en/rest/repos/repos#create-a-repository-dispatch-event
  - WP Webhooks plugin: https://wordpress.org/plugins/wp-webhooks/

  **Acceptance Criteria**:
  - [ ] Webhook configured in WordPress
  - [ ] Webhook triggers on post publish
  - [ ] GitHub Actions workflow runs automatically
  - [ ] Site updates within 5 minutes of publish

  **QA Scenarios**:
  ```
  Scenario: Publish triggers deployment
    Tool: WordPress admin + Browser
    Preconditions: Webhook configured
    Steps:
      1. Create and publish new post in WP
      2. Wait 2-3 minutes
      3. Check GitHub Actions (should be running)
      4. Wait for completion
      5. Check live site for new post
    Expected Result: Post appears on site
    Evidence: .sisyphus/evidence/task-3-5-webhook-trigger.txt
  ```

  **Commit**: NO (WP configuration, not repo code)

- [ ] 3.6 Support hybrid content (custom Hugo pages)

  **What to do**:
  - Document hybrid approach: WP pages vs Hugo pages
  - Create example custom page in `content/custom/`
  - Create custom layout template example
  - Document template hierarchy (how Hugo chooses layouts)
  - Show how to override WP content with Hugo content

  **Must NOT do**:
  - Do not force all pages through WP
  - Do not commit paraboss-specific custom pages

  **Recommended Agent Profile**:
  - **Category**: `unspecified-high`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits)
  - **Next Task**: None
  - **Previous Task**: 2.1

  **References**:
  - Hugo template lookup order: https://gohugo.io/templates/lookup-order/
  - Hugo content types: https://gohugo.io/content-management/types/

  **Acceptance Criteria**:
  - [ ] Documentation explains hybrid approach
  - [ ] Example custom page exists
  - [ ] Example custom layout exists
  - [ ] Users understand how to choose WP vs Hugo for pages

  **QA Scenarios**:
  ```
  Scenario: Custom page displays with custom template
    Tool: Browser
    Preconditions: Custom page and layout created
    Steps:
      1. Navigate to custom page URL
      2. Verify: Custom layout applied
      3. Verify: Different from standard page layout
    Expected Result: Custom styling visible
    Evidence: .sisyphus/evidence/task-3-6-custom-page.png
  ```

  **Commit**: YES (examples + documentation)
  - Message: `feat(pipeline): Add hybrid content support with examples`
  - Files: `hugo-site/content/custom/`, `hugo-site/layouts/custom/`, docs/

- [ ] 4.1 Create generic setup.sh configuration script

  **What to do**:
  - Create interactive `setup.sh` script
  - Prompt for: domain name, site title, author name, author email, Tailscale domain, GitHub repo, Cloudflare credentials
  - Generate `.env` file with user values
  - Update placeholder values in docker-compose.yml (sed/awk)
  - Update placeholder values in hugo.toml
  - Create initial GitHub secrets template file
  - Make script executable and test

  **Must NOT do**:
  - Do not overwrite existing .env without warning
  - Do not commit generated files

  **Recommended Agent Profile**:
  - **Category**: `quick`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits)
  - **Next Task**: None
  - **Previous Task**: 1.1, 2.2

  **References**:
  - Bash scripting guide: https://tldp.org/LDP/abs/html/
  - sed documentation: https://www.gnu.org/software/sed/manual/sed.html

  **Acceptance Criteria**:
  - [ ] setup.sh exists and is executable
  - [ ] Script prompts for all required values
  - [ ] .env file generated correctly
  - [ ] Placeholder files updated
  - [ ] Script handles errors gracefully

  **QA Scenarios**:
  ```
  Scenario: Setup script runs successfully
    Tool: Bash
    Preconditions: Fresh clone of repo
    Steps:
      1. Run: ./setup.sh
      2. Enter test values at prompts
      3. Verify: .env file created
      4. Verify: docker-compose.yml updated
    Expected Result: Configuration applied
    Evidence: .sisyphus/evidence/task-4-1-setup-script.txt
  ```

  **Commit**: YES
  - Message: `feat(docs): Add interactive setup.sh configuration script`
  - Files: `setup.sh`, `.env.example`

- [ ] 4.2 Write comprehensive README documentation

  **What to do**:
  - Write README.md with full project documentation
  - Sections: Overview, Architecture, Prerequisites, Quick Start, Configuration, Deployment, Troubleshooting
  - Document all manual setup steps (Giscus, Cloudflare, GitHub secrets)
  - Include architecture diagram (ASCII art or link)
  - Document all .env variables
  - Include example values and explanations
  - Add troubleshooting section for common issues
  - Link to paraboss.com as example

  **Must NOT do**:
  - Do not write generic fluff
  - Do not skip manual setup steps

  **Recommended Agent Profile**:
  - **Category**: `writing`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits)
  - **Next Task**: None
  - **Previous Task**: All previous tasks (for accuracy)

  **References**:
  - Good README examples: https://github.com/matiassingers/awesome-readme
  - Markdown guide: https://www.markdownguide.org/

  **Acceptance Criteria**:
  - [ ] README.md covers all sections
  - [ ] Manual setup steps are clear
  - [ ] All configuration options documented
  - [ ] Troubleshooting section included
  - [ ] Example site linked

  **QA Scenarios**:
  ```
  Scenario: New user can follow README
    Tool: Manual review
    Preconditions: README complete
    Steps:
      1. Review README for completeness
      2. Check all links work
      3. Verify setup steps are clear
    Expected Result: README is comprehensive
    Evidence: .sisyphus/evidence/task-4-2-readme-review.txt
  ```

  **Commit**: YES
  - Message: `docs: Add comprehensive README with setup instructions`
  - Files: `README.md`

- [ ] 4.3 Theme customization (site-specific)

  **What to do**:
  - Add site-specific CSS overrides (colors, fonts)
  - Configure favicon
  - Add logo (if any)
  - Configure analytics (Plausible or GoatCounter - privacy-friendly)
  - Set up RSS feed
  - Add search functionality (Pagefind or Fuse.js)
  - Customize footer

  **Must NOT do**:
  - Do not modify Stack theme files directly
  - Do not add heavy JavaScript

  **Recommended Agent Profile**:
  - **Category**: `visual-engineering`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits)
  - **Next Task**: None
  - **Previous Task**: 2.1

  **References**:
  - Stack theme customization: https://stack.jimmycai.com/config/
  - Hugo custom CSS: https://gohugo.io/hugo-pipes/resource-from-template/

  **Acceptance Criteria**:
  - [ ] Custom CSS file exists and loads
  - [ ] Favicon configured
  - [ ] Analytics configured (if used)
  - [ ] Search functionality works
  - [ ] Site looks professional

  **QA Scenarios**:
  ```
  Scenario: Customizations load correctly
    Tool: Browser
    Preconditions: Site running
    Steps:
      1. Open site
      2. Verify: Custom CSS applied
      3. Verify: Favicon loads
      4. Test: Search functionality
    Expected Result: Customizations visible and working
    Evidence: .sisyphus/evidence/task-4-3-customizations.png
  ```

  **Commit**: NO (site-specific customizations belong in private repo)
  - Note: This task produces site-specific files that should not be committed to wp-hugo-static
  - Files: `hugo-site/assets/css/custom.css`, config updates

- [ ] 4.4 Security hardening and review

  **What to do**:
  - Review security headers in Caddyfile (already configured in 1.1)
  - Disable WP REST API user enumeration
  - Remove WP version from headers
  - Document security model (Tailscale = security layer)
  - Verify no sensitive data exposed in GitHub Actions logs
  - Test security headers with securityheaders.com

  **Must NOT do**:
  - Do not rely solely on "security through obscurity"
  - Do not expose WP admin to internet

  **Recommended Agent Profile**:
  - **Category**: `quick`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits)
  - **Next Task**: None
  - **Previous Task**: 1.1

  **References**:
  - Caddy security headers: https://caddyserver.com/docs/caddyfile/directives/header
  - WP hardening: https://wordpress.org/documentation/article/hardening-wordpress/
  - Security headers: https://securityheaders.com/

  **Acceptance Criteria**:
  - [ ] Security headers configured in Caddy
  - [ ] WP user enumeration disabled
  - [ ] Security model documented
  - [ ] Security scan passes (securityheaders.com)

  **QA Scenarios**:
  ```
  Scenario: Security headers present
    Tool: Bash/curl
    Preconditions: Site running
    Steps:
      1. Run: curl -I https://${DOMAIN}
      2. Verify: Security headers present
    Expected Result: X-Frame-Options, CSP, etc. visible
    Evidence: .sisyphus/evidence/task-4-4-security-headers.txt
  ```

  **Commit**: YES
  - Message: `feat(infra): Add security hardening to Caddy and WP`
  - Files: `Caddyfile`, WP config docs

- [ ] 5.1 Final end-to-end testing

  **What to do**:
  - Test complete workflow: WP publish â†’ GitHub Actions â†’ Cloudflare Pages
  - Test backup and restore procedure
  - Test WUD container update flow
  - Test Giscus comments on live site
  - Test mobile responsiveness
  - Test all navigation links
  - Verify no console errors
  - Test RSS feed

  **Must NOT do**:
  - Do not skip testing on mobile devices
  - Do not launch with broken functionality

  **Recommended Agent Profile**:
  - **Category**: `unspecified-high`
  - **Skills**: []

  **Parallelization**:
  - **Can Run In Parallel**: NO
  - **Next Task**: None
  - **Previous Task**: All previous phases

  **References**:
  - Lighthouse CI: https://github.com/GoogleChrome/lighthouse-ci
  - Browser testing: https://www.browserstack.com/

  **Acceptance Criteria**:
  - [ ] End-to-end test passes (publish to live within 5 min)
  - [ ] Backup restore works
  - [ ] WUD updates containers
  - [ ] Comments load
  - [ ] Site passes Lighthouse audit (performance 90+)
  - [ ] No console errors

  **QA Scenarios**:
  ```
  Scenario: End-to-end publish flow
    Tool: Manual testing
    Preconditions: All systems running
    Steps:
      1. Publish new post in WP
      2. Wait for GitHub Actions
      3. Verify post appears on live site
      4. Test comment on post
      5. Test on mobile
    Expected Result: Everything works
    Evidence: .sisyphus/evidence/task-5-1-e2e-test.txt
  ```

  **Commit**: NO (testing phase, no code changes)

- [ ] 5.2 Content migration

  **What to do**:
  - Export existing WordPress content (if migrating from existing site)
  - Run conversion scripts on all content
  - Review and fix formatting issues
  - Verify all images transferred
  - Update internal links
  - Set up redirects (if URLs changed)
  - Test all migrated content

  **Must NOT do**:
  - Do not lose content during migration
  - Do not break existing URLs without redirects

  **Recommended Agent Profile**:
  - **Category**: `unspecified-high`
  - **Skills**: []

  **Parallelization**:
  - **Can Run In Parallel**: NO
  - **Next Task**: None
  - **Previous Task**: 3.1, 3.2, 3.3

  **References**:
  - WordPress export: https://wordpress.org/support/article/tools-export-screen/
  - Hugo aliases (redirects): https://gohugo.io/content-management/urls/#aliases

  **Acceptance Criteria**:
  - [ ] All content migrated
  - [ ] Images transferred
  - [ ] Links working
  - [ ] Redirects configured (if needed)

  **QA Scenarios**:
  ```
  Scenario: Migrated content displays correctly
    Tool: Browser
    Preconditions: Migration complete
    Steps:
      1. Check migrated posts
      2. Verify images load
      3. Test internal links
    Expected Result: Content intact and functional
    Evidence: .sisyphus/evidence/task-5-2-migration.txt
  ```

  **Commit**: NO (content, not code)

- [ ] 5.3 Domain and DNS setup

  **What to do**:
  - Configure Cloudflare Pages custom domain (paraboss.com)
  - Set up DNS records (CNAME or A records)
  - Enable HTTPS (Cloudflare handles automatically)
  - Configure www redirect (www â†’ apex or vice versa)
  - Test domain resolution
  - Verify SSL certificate valid

  **Must NOT do**:
  - Do not skip HTTPS
  - Do not leave DNS misconfigured

  **Recommended Agent Profile**:
  - **Category**: `quick`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits) (with testing)
  - **Next Task**: None
  - **Previous Task**: 3.4

  **References**:
  - Cloudflare Pages custom domains: https://developers.cloudflare.com/pages/configuration/custom-domains/
  - DNS records: https://developers.cloudflare.com/dns/manage-dns-records/

  **Acceptance Criteria**:
  - [ ] Domain points to Cloudflare Pages
  - [ ] HTTPS working
  - [ ] Redirects configured
  - [ ] Site accessible at custom domain

  **QA Scenarios**:
  ```
  Scenario: Custom domain works
    Tool: Browser
    Preconditions: DNS configured
    Steps:
      1. Navigate to paraboss.com
      2. Verify: Site loads
      3. Verify: HTTPS padlock visible
    Expected Result: Site accessible with valid SSL
    Evidence: .sisyphus/evidence/task-5-3-domain.txt
  ```

  **Commit**: NO (DNS configuration, not code)

- [ ] 5.4 Open source preparation

  **What to do**:
  - Add LICENSE file (GNU Affero General Public License v3.0 / AGPLv3)
  - Add CONTRIBUTING.md with contribution guidelines
  - Add CODE_OF_CONDUCT.md (Ruby Community Code of Conduct)
  - Review entire repo for secrets/keys
  - Verify .gitignore excludes all sensitive files
  - Create GitHub repo description
  - Add topics/tags to GitHub repo
  - Create initial release/tag

  **Must NOT do**:
  - Do not publish with secrets in history

  **Recommended Agent Profile**:
  - **Category**: `writing`
  - **Skills**: []

  **Parallelization**:
  - **Execution Mode**: Sequential (per-task commits)
  - **Next Task**: 5.5
  - **Previous Task**: None

  **References**:
  - Choose a license: https://choosealicense.com/
  - Contributing guidelines: https://docs.github.com/en/communities/setting-up-your-project-for-healthy-contributions/setting-guidelines-for-repository-contributors

  **Acceptance Criteria**:
  - [ ] LICENSE file present
  - [ ] CONTRIBUTING.md present
  - [ ] CODE_OF_CONDUCT.md present
  - [ ] No secrets in repo
  - [ ] Repo description and topics set

  **QA Scenarios**:
  ```
  Scenario: Repo ready for open source
    Tool: Manual review
    Preconditions: All files prepared
    Steps:
      1. Review LICENSE
      2. Check for secrets: git log --all --source --full-history -S 'password'
      3. Verify .gitignore
    Expected Result: Clean repo ready for public
    Evidence: .sisyphus/evidence/task-5-4-oss-ready.txt
  ```

  **Commit**: YES
  - Message: `chore: Prepare for open source release`
  - Files: `LICENSE`, `CONTRIBUTING.md`, `CODE_OF_CONDUCT.md`

- [ ] 5.5 Repository publication and launch

  **What to do**:
  - Make GitHub repository public
  - Announce on relevant channels (optional)
  - Monitor for issues and questions
  - Create GitHub issue templates
  - Update README with live example link
  - Document any post-launch fixes
  - Celebrate! ðŸŽ‰

  **Must NOT do**:
  - Do not ignore community feedback
  - Do not abandon the project immediately

  **Recommended Agent Profile**:
  - **Category**: `unspecified-low`
  - **Skills**: []

  **Parallelization**:
  - **Can Run In Parallel**: NO (final step)
  - **Next Task**: None
  - **Previous Task**: All other tasks

  **Acceptance Criteria**:
  - [ ] Repository is public
  - [ ] paraboss.com is live
  - [ ] wp-hugo-static repo is usable by others
  - [ ] Documentation complete

  **QA Scenarios**:
  ```
  Scenario: Repo is public and functional
    Tool: Browser
    Preconditions: All tasks complete
    Steps:
      1. View repo in incognito mode (not logged in)
      2. Clone repo to temp directory
      3. Follow README quickstart
    Expected Result: Repo is public and usable
    Evidence: .sisyphus/evidence/task-5-5-launch.txt
  ```

  **Commit**: NO (repository settings, not code)

---

## Final Verification Wave

- [ ] F1. **Plan Compliance Audit** â€” verify all deliverables match plan
- [ ] F2. **End-to-end Test** â€” WP publish â†’ live site within 5 minutes
- [ ] F3. **Backup/Restore Test** â€” restore from backup works
- [ ] F4. **Documentation Review** â€” README is clear and complete

## Commit Strategy

| After Task | Message | Files |
|------------|---------|-------|
| Phase 1 | `feat(infra): WordPress Docker setup with WUD` | docker-compose.yml, Caddyfile, backup.sh |
| Phase 2 | `feat(site): Hugo base with Stack theme` | hugo/ directory, configs |
| Phase 3 | `feat(pipeline): WPâ†’Hugo conversion and CI/CD` | scripts/, .github/workflows/ |
| Phase 4 | `docs: Setup script and comprehensive README` | setup.sh, README.md |
| Phase 5 | `chore: Prepare for open source release` | LICENSE, CONTRIBUTING.md |

## Success Criteria

### Verification Commands
```bash
# Test WordPress is accessible
curl -s https://paraboss.parasquid.dev/wp-json/wp/v2/posts | jq '.[0].title.rendered'

# Test Hugo builds
cd hugo-site && hugo --minify

# Test backup exists
ls -la /mnt/nas/backups/paraboss/

# Test WUD is running
docker ps | grep wud
```

### Final Checklist
- [ ] All "Must Have" present
- [ ] All "Must NOT Have" absent
- [ ] wp-hugo-static repo is public
- [ ] paraboss.com is live and updating
- [ ] README explains full setup
